@{
    ViewBag.Title = "Home Page";
    Layout = "~/Views/Shared/_ScaleLayout.cshtml";
}

@section scripts {
    <!--Script references. -->
    <!--The jQuery library is required and is referenced by default in _Layout.cshtml. -->
    <!--Reference the SignalR library. -->
    <script src="~/Scripts/jquery.signalR-2.0.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="~/signalr/hubs"></script>
    <!--SignalR script to update the chat page and send messages.-->
    <script type="text/javascript">
        $(function () {

            $.chatPlugin = function (options) {

                var chat = null;
                var isReady = false;

                var settings = $.extend(true, {
                    container: "chatContainer",
                    messageContainer: "messageContainer",
                    nameContainer: "displayname"
                }, options);

                if (typeof (options) == "undefined" || options == null) { options = {}; }

                var n = {
                    init: function () {
                        chat = $.connection.chatHub;
                        // Start the connection.
                        $.connection.hub.start().done(function () {
                            isReady = true;
                            $("#" + settings.messageContainer).val('').focus();
                        });
                    },

                    getChat: function () {
                        return chat;
                    },
                };

                var generator = {

                    generateMessage: function(type, name, message)
                    {
                        var html = "";
                        if(type == "sending")
                        {
                            html = "<article id='chat-id-1' class='chat-item left'>";
                            html += "<a href='#' class='pull-left thumb-sm avatar'><img src='/Content/ScaleTheme/images/a2.png'></a>";
                            html += "<section class='chat-body'>";
                            html += "<div class='panel b-light text-sm m-b-none'>";
                            html += "<div class='panel-body'>";
                            html += "<span class='arrow left'></span>";
                            html += "<p class='m-b-none'>" + message + "</p>";
                            html += "</div>";
                            html += "</div>";
                            html += "<small class='text-muted'><i class='fa fa-ok text-success'></i> " + name + "</small>";
                            html += "</section>";
                            html += "</article>";
                        }

                        if(type== "receiving")
                        {
                            html += "<article id='chat-id-1' class='chat-item right'>";
                            html += "<a href='#' class='pull-right thumb-sm avatar'><img src='/Content/ScaleTheme/images/a3.png' class='img-circle'></a>";
                            html += "<section class='chat-body'>";
                            html += "<div class='panel bg-light text-sm m-b-none'>";
                            html += "<div class='panel-body'>";
                            html += "<span class='arrow right'></span>";
                            html += "<p class='m-b-none'>"+ message +"</p>";
                            html += "</div>";
                            html += "</div>";
                            html += "<small class='text-muted'>"+ name +"</small>";
                            html += "</section>";
                            html += "</article>";
                        }

                        return html;
                    }
                };

                var transport = {
                    sendMessage: function (message) {

                        if (isReady) {
                            chat.server.send(message);
                            // Clear text box and reset focus for next comment.
                            $("#" + settings.messageContainer).val('').focus();
                        }
                        else {
                            alert("The plugin is still not ready!");
                        }
                        
                    },

                    addMessage: function (message) {
                        // Add the message to the page.
                        var html = "";
                        if (message.Name == $("#" + settings.nameContainer).val()) {
                            html = generator.generateMessage("sending", message.Name, message.MessageText);
                        }
                        else {
                            html = generator.generateMessage("receiving", message.Name, message.MessageText);
                        }

                        $("#" + settings.container).append(html);
                        //scroll to the bottom of the container
                        var scrollTo = $("#" + settings.container)[0].scrollHeight + 50;
                        $("#" + settings.container).slimScroll({ scrollTo: scrollTo });
                    }
                }

                return {
                    Init: n.init,
                    GetChat: n.getChat,
                    SendMessage: transport.sendMessage,
                    AddMessage: transport.addMessage
                };
            };
           
        });
    </script>

    <script type="text/javascript">
        $(document).ready(function () {
            // Get the user name and store it to prepend to messages.
            $('#displayname').val(prompt('Enter your name:', ''));

            var chat = $.chatPlugin({
                container: "chatContainer",
                messageContainer: "messageContainer",
                nameContainer: "displayname"
            });

            chat.Init();

            $("#messageForm").submit(function (e) {
                var name = $("#displayname").val();
                var text = $("#messageContainer").val();
                var message = { Name: name, MessageText: text };
                chat.SendMessage(message);

                return false;
            });

            // Create a function that the hub can call back to display messages.
            chat.GetChat().client.addNewMessageToPage = function (message) {
                chat.AddMessage(message);
            };


        });

    </script>
}
<input type="hidden" id="displayname" />
<section class="hbox stretch">
    <section>
        <section class="vbox">
            <section class="scrollable padder">
                <section class="row m-b-md">
                    <div class="col-sm-6">
                        <h3 class="m-b-xs text-black">Chat Dashboard</h3>
                        <small>Welcome back, John Smith, <i class="fa fa-map-marker fa-lg text-primary"></i> New York City</small>
                    </div>
                    <div class="col-sm-6 text-right text-left-xs m-t-md">
                        <div class="btn-group">
                            <a class="btn btn-rounded btn-default b-2x dropdown-toggle" data-toggle="dropdown">Widgets <span class="caret"></span></a>
                            <ul class="dropdown-menu text-left pull-right">
                                <li><a href="#">Notification</a></li>
                                <li><a href="#">Messages</a></li>
                                <li><a href="#">Analysis</a></li>
                                <li class="divider"></li>
                                <li><a href="#">More settings</a></li>
                            </ul>
                        </div>
                        <a href="#" class="btn btn-icon b-2x btn-default btn-rounded hover"><i class="i i-bars3 hover-rotate"></i></a>
                        <a href="#nav, #sidebar" class="btn btn-icon b-2x btn-info btn-rounded" data-toggle="class:nav-xs, show"><i class="fa fa-bars"></i></a>
                    </div>
                </section>
                <div class="row">
                    <div class="col-sm-6">
                        <!-- THIS IS THE CHAT SECTION -->
                        <section class="panel panel-default">
                            <header class="panel-heading">Chat</header>
                            <section id="chatContainer" class="chat-list panel-body slim-scroll" data-height="350px" data-size="10px">
                                <article id="chat-id-1" class="chat-item right">
                                    <a href="#" class="pull-right thumb-sm avatar"><img src="/Content/ScaleTheme/images/a3.png" class="img-circle"></a>
                                    <section class="chat-body">
                                        <div class="panel bg-light text-sm m-b-none">
                                            <div class="panel-body">
                                                <span class="arrow right"></span>
                                                <p class="m-b-none">You can start with your communication :)</p>
                                            </div>
                                        </div>
                                        <small class="text-muted">Administrator</small>
                                    </section>
                                </article>
                            </section>

                            <footer class="panel-footer">
                                <!-- chat form -->
                                <article class="chat-item" id="chat-form">
                                    <a class="pull-left thumb-sm avatar"><img src="/Content/ScaleTheme/images/a3.png" class="img-circle"></a>
                                    <section class="chat-body">
                                        <form action="" class="m-b-none" id="messageForm">
                                            <div class="input-group">
                                                <input type="text" id="messageContainer" class="form-control" placeholder="Say something">
                                                <span class="input-group-btn">
                                                    <button id="sendMessage" class="btn btn-default" type="submit">SEND</button>
                                                </span>
                                            </div>
                                        </form>
                                    </section>
                                </article>
                            </footer>

                        </section>
                    </div>
                </div>
            </section>
        </section>
    </section>
    <!-- side content -->
    <aside class="aside-md bg-black hide" id="sidebar">
        <section class="vbox animated fadeInRight">
            <section class="scrollable">
                <div class="wrapper"><strong>Live feed</strong></div>
                <ul class="list-group no-bg no-borders auto">
                    <li class="list-group-item">
                        <span class="fa-stack pull-left m-r-sm">
                            <i class="fa fa-circle fa-stack-2x text-success"></i>
                            <i class="fa fa-reply fa-stack-1x text-white"></i>
                        </span>
                        <span class="clear">
                            <a href="#">Goody@gmail.com</a> sent your email
                            <small class="icon-muted">13 minutes ago</small>
                        </span>
                    </li>
                    <li class="list-group-item">
                        <span class="fa-stack pull-left m-r-sm">
                            <i class="fa fa-circle fa-stack-2x text-danger"></i>
                            <i class="fa fa-file-o fa-stack-1x text-white"></i>
                        </span>
                        <span class="clear">
                            <a href="#">Mide@live.com</a> invite you to join a meeting
                            <small class="icon-muted">20 minutes ago</small>
                        </span>
                    </li>
                    <li class="list-group-item">
                        <span class="fa-stack pull-left m-r-sm">
                            <i class="fa fa-circle fa-stack-2x text-info"></i>
                            <i class="fa fa-map-marker fa-stack-1x text-white"></i>
                        </span>
                        <span class="clear">
                            <a href="#">Geoge@yahoo.com</a> is online
                            <small class="icon-muted">1 hour ago</small>
                        </span>
                    </li>
                    <li class="list-group-item">
                        <span class="fa-stack pull-left m-r-sm">
                            <i class="fa fa-circle fa-stack-2x text-primary"></i>
                            <i class="fa fa-info fa-stack-1x text-white"></i>
                        </span>
                        <span class="clear">
                            <a href="#"><strong>Admin</strong></a> post a info
                            <small class="icon-muted">1 day ago</small>
                        </span>
                    </li>
                </ul>
                <div class="wrapper"><strong>Friends</strong></div>
                <ul class="list-group no-bg no-borders auto">
                    <li class="list-group-item">
                        <div class="media">
                            <span class="pull-left thumb-sm avatar">
                                <img src="~/Content/themes/ScaleTheme//Content/ScaleTheme/images/a3.png" alt="..." class="img-circle">
                                <i class="on b-black bottom"></i>
                            </span>
                            <div class="media-body">
                                <div><a href="#">Chris Fox</a></div>
                                <small class="text-muted">about 2 minutes ago</small>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item">
                        <div class="media">
                            <span class="pull-left thumb-sm avatar">
                                <img src="~/Content/themes/ScaleTheme//Content/ScaleTheme/images/a2.png" alt="...">
                                <i class="on b-black bottom"></i>
                            </span>
                            <div class="media-body">
                                <div><a href="#">Amanda Conlan</a></div>
                                <small class="text-muted">about 2 hours ago</small>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item">
                        <div class="media">
                            <span class="pull-left thumb-sm avatar">
                                <img src="~/Content/themes/ScaleTheme//Content/ScaleTheme/images/a1.png" alt="...">
                                <i class="busy b-black bottom"></i>
                            </span>
                            <div class="media-body">
                                <div><a href="#">Dan Doorack</a></div>
                                <small class="text-muted">3 days ago</small>
                            </div>
                        </div>
                    </li>
                    <li class="list-group-item">
                        <div class="media">
                            <span class="pull-left thumb-sm avatar">
                                <img src="~/Content/themes/ScaleTheme//Content/ScaleTheme/images/a0.png" alt="...">
                                <i class="away b-black bottom"></i>
                            </span>
                            <div class="media-body">
                                <div><a href="#">Lauren Taylor</a></div>
                                <small class="text-muted">about 2 minutes ago</small>
                            </div>
                        </div>
                    </li>
                </ul>
            </section>
        </section>
    </aside>
    <!-- / side content -->
</section>
<a href="#" class="hide nav-off-screen-block" data-toggle="class:nav-off-screen" data-target="#nav"></a>
